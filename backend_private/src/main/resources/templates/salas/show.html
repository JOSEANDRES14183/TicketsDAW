<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head th:replace="fragments/layout :: head(${sala.nombre})"></head>

<body>

<header th:replace="fragments/layout :: header('Salas')"></header>

<main>

    <section class="container-md">
        <div class="mb-4 d-flex justify-content-between">
            <div class="d-flex flex-column">
                <h3 th:text="${sala.nombre}"></h3>
                <span th:text="${sala.direccion}"></span>
                <span th:text="${sala.ciudad.nombre}"></span>
                <span>Aforo máximo: <span th:text="${sala.aforoMax}"></span></span>
            </div>

            <div class="sala-map border rounded" id="googleMap">

            </div>
        </div>

        <div class="mb-4">
            <h3>Distribución</h3>
            <a th:href="@{'/salas/' + ${sala.id} + '/butacas'}" th:text="${sala.butacas.size()<=0} ? '+Añadir distribución' : '+Modificar distribución'"
               class="d-inline-block text-secondary fst-italic text-decoration-none mt-2 mb-3">
                +Añadir distribución</a>
                <table id="layout"></table>
        </div>

        <div class="mb-4">
            <h3 class="mb-3">Restricciones</h3>
            <table class="table table-bordered table-striped">
                <tr>
                    <th>Estas</th>
                    <th>son</th>
                    <th>las</th>
                    <th>restricciones</th>
                </tr>
                <tr>
                    <td>Estos</td>
                    <td>son</td>
                    <td>los</td>
                    <td>datos</td>
                </tr>
            </table>
        </div>

        <a href="/salas" class="btn btn-primary">Volver</a>

    </section>

</main>

<footer th:replace="fragments/layout :: footer"></footer>

<script th:inline="javascript">

    // https://thisinterestsme.com/google-maps-api-location-picker-example/

    function myMap(){

        let mapProp= {
            center:new google.maps.LatLng(39.3847,16.9272),
            zoom:5,
        };

        let map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
        let myPosition = {lat: 39.3847, lng: 16.9272};
        let marker = new google.maps.Marker({position: myPosition});

        marker.setMap(map);
    }

    /*<![CDATA[*/
    let butacasJSON = [[${butacas}]];
    /*]]>*/

    let butacas = JSON.parse(butacasJSON);

    let layout = document.getElementById("layout");
    let text = "";

    for (let i = 0; i<butacas.length; i++){
        text+="<tr>";
        for (let j = 0;j<butacas[i].length;j++){
            text+="<td><i class=\"bi bi-circle-fill\"></i></td>";
        }
       text+="</tr>";
    }

    layout.innerHTML = text;

    // console.log(butacasJSON);
    // console.log(butacas);

</script>

<script th:src="@{/js/bootstrap.bundle.min.js}"></script>

<script src="https://maps.googleapis.com/maps/api/js?
key=AIzaSyCIBWMOCC_XY2ia1tPFUKYjY4ACzhqbEA0&callback=myMap"></script>

</body>
</html>